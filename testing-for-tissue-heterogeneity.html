<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4 Testing for tissue heterogeneity | Tissue heterogeneity is prevalent in gene expression studies (Supplementary Information)</title>
  <meta name="description" content="In this study, we systematically search GEO and ARCHS4 for cases of “tissue heterogeneity.”" />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="4 Testing for tissue heterogeneity | Tissue heterogeneity is prevalent in gene expression studies (Supplementary Information)" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="In this study, we systematically search GEO and ARCHS4 for cases of “tissue heterogeneity.”" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4 Testing for tissue heterogeneity | Tissue heterogeneity is prevalent in gene expression studies (Supplementary Information)" />
  
  <meta name="twitter:description" content="In this study, we systematically search GEO and ARCHS4 for cases of “tissue heterogeneity.”" />
  

<meta name="author" content="Gregor Sturm, Markus List, Jitao David Zhang" />


<meta name="date" content="2021-06-26" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="curating-data.html"/>
<link rel="next" href="additional-results.html"/>
<script src="libs/header-attrs-2.8/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>



<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> About this document</a></li>
<li class="chapter" data-level="2" data-path="validating-signatures.html"><a href="validating-signatures.html"><i class="fa fa-check"></i><b>2</b> Validating Tissue Signatures</a>
<ul>
<li class="chapter" data-level="2.1" data-path="validating-signatures.html"><a href="validating-signatures.html#data"><i class="fa fa-check"></i><b>2.1</b> Data</a></li>
<li class="chapter" data-level="2.2" data-path="validating-signatures.html"><a href="validating-signatures.html#cross-validation-of-signatures-on-the-gtex-dataset"><i class="fa fa-check"></i><b>2.2</b> Cross-Validation of signatures on the GTEx dataset</a></li>
<li class="chapter" data-level="2.3" data-path="validating-signatures.html"><a href="validating-signatures.html#reference-signatures"><i class="fa fa-check"></i><b>2.3</b> Reference Signatures</a></li>
<li class="chapter" data-level="2.4" data-path="validating-signatures.html"><a href="validating-signatures.html#cross-platform-cross-species-validation"><i class="fa fa-check"></i><b>2.4</b> Cross-Platform Cross-Species Validation</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="curating-data.html"><a href="curating-data.html"><i class="fa fa-check"></i><b>3</b> Sample data and metadata</a>
<ul>
<li class="chapter" data-level="3.1" data-path="curating-data.html"><a href="curating-data.html#normalize-tissues"><i class="fa fa-check"></i><b>3.1</b> Standardize Tissue Names</a></li>
<li class="chapter" data-level="3.2" data-path="curating-data.html"><a href="curating-data.html#geo"><i class="fa fa-check"></i><b>3.2</b> GEO</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="curating-data.html"><a href="curating-data.html#downloading-geo-data"><i class="fa fa-check"></i><b>3.2.1</b> Downloading GEO data</a></li>
<li class="chapter" data-level="3.2.2" data-path="curating-data.html"><a href="curating-data.html#filtering-geo-data"><i class="fa fa-check"></i><b>3.2.2</b> Filtering GEO data</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="curating-data.html"><a href="curating-data.html#archs4"><i class="fa fa-check"></i><b>3.3</b> ARCHS4</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="testing-for-tissue-heterogeneity.html"><a href="testing-for-tissue-heterogeneity.html"><i class="fa fa-check"></i><b>4</b> Testing for tissue heterogeneity</a>
<ul>
<li class="chapter" data-level="4.1" data-path="testing-for-tissue-heterogeneity.html"><a href="testing-for-tissue-heterogeneity.html#sec:signatures"><i class="fa fa-check"></i><b>4.1</b> Tissue signatures</a></li>
<li class="chapter" data-level="4.2" data-path="testing-for-tissue-heterogeneity.html"><a href="testing-for-tissue-heterogeneity.html#testing-samples-for-heterogeneity"><i class="fa fa-check"></i><b>4.2</b> Testing samples for heterogeneity</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="additional-results.html"><a href="additional-results.html"><i class="fa fa-check"></i><b>5</b> Additional Results</a>
<ul>
<li class="chapter" data-level="5.1" data-path="additional-results.html"><a href="additional-results.html#distribution-of-heterogeneity-across-studies"><i class="fa fa-check"></i><b>5.1</b> Distribution of heterogeneity across studies</a></li>
<li class="chapter" data-level="5.2" data-path="additional-results.html"><a href="additional-results.html#heterogeneity-along-time"><i class="fa fa-check"></i><b>5.2</b> Heterogeneity along time</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>6</b> References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Tissue heterogeneity is prevalent in gene expression studies (Supplementary Information)</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="testing-for-tissue-heterogeneity" class="section level1" number="4">
<h1><span class="header-section-number">4</span> Testing for tissue heterogeneity</h1>
<div id="sec:signatures" class="section level2" number="4.1">
<h2><span class="header-section-number">4.1</span> Tissue signatures</h2>
<p>In section <a href="validating-signatures.html#validating-signatures">2</a>, we identified a set of
9 <em>reference signatures</em> (table <a href="testing-for-tissue-heterogeneity.html#tab:refsig">4.1</a>) which unambiguously
identify their corresponding tissue across platforms and species. In addition to that,
we use 120 tissue signatures from the BioQC publication, which we refer to as <em>query signatures</em>.</p>
<table>
<caption><span id="tab:refsig">Table 4.1: </span>reference signatures</caption>
<thead>
<tr class="header">
<th align="left">Reference Signature</th>
<th align="left">Tissue</th>
<th align="left">NA</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">GTEX_Blood</td>
<td align="left">blood/immune</td>
<td align="left">blood</td>
</tr>
<tr class="even">
<td align="left">GTEX_Blood</td>
<td align="left">blood/immune</td>
<td align="left">white blood cells</td>
</tr>
<tr class="odd">
<td align="left">GTEX_Blood</td>
<td align="left">blood/immune</td>
<td align="left">pbmc</td>
</tr>
<tr class="even">
<td align="left">GTEX_Brain</td>
<td align="left">brain</td>
<td align="left">brain</td>
</tr>
<tr class="odd">
<td align="left">GTEX_Brain</td>
<td align="left">brain</td>
<td align="left">cerebellum</td>
</tr>
<tr class="even">
<td align="left">GTEX_Brain</td>
<td align="left">brain</td>
<td align="left">cortex</td>
</tr>
<tr class="odd">
<td align="left">GTEX_Brain</td>
<td align="left">brain</td>
<td align="left">frontal cortex</td>
</tr>
<tr class="even">
<td align="left">GTEX_Brain</td>
<td align="left">brain</td>
<td align="left">prefrontal cortex</td>
</tr>
<tr class="odd">
<td align="left">GTEX_Brain</td>
<td align="left">brain</td>
<td align="left">hippocampus</td>
</tr>
<tr class="even">
<td align="left">GTEX_Brain</td>
<td align="left">brain</td>
<td align="left">hypothalamus</td>
</tr>
<tr class="odd">
<td align="left">GTEX_Heart</td>
<td align="left">heart</td>
<td align="left">heart</td>
</tr>
<tr class="even">
<td align="left">GTEX_Kidney</td>
<td align="left">kidney</td>
<td align="left">kidney</td>
</tr>
<tr class="odd">
<td align="left">GTEX_Liver</td>
<td align="left">liver</td>
<td align="left">liver</td>
</tr>
<tr class="even">
<td align="left">GTEX_Liver</td>
<td align="left">liver</td>
<td align="left">hepatocyte</td>
</tr>
<tr class="odd">
<td align="left">GTEX_Muscle_Skeletal</td>
<td align="left">skeletal muscle</td>
<td align="left">skeletal muscle</td>
</tr>
<tr class="even">
<td align="left">GTEX_Pancreas</td>
<td align="left">pancreas</td>
<td align="left">pancreas</td>
</tr>
<tr class="odd">
<td align="left">GTEX_Skin</td>
<td align="left">skin</td>
<td align="left">skin</td>
</tr>
<tr class="even">
<td align="left">GTEX_Testis</td>
<td align="left">testis</td>
<td align="left">testis</td>
</tr>
</tbody>
</table>
</div>
<div id="testing-samples-for-heterogeneity" class="section level2" number="4.2">
<h2><span class="header-section-number">4.2</span> Testing samples for heterogeneity</h2>
<p>We tested for enrichment of 120
selected signatures provided by BioQC (query signatures) and the 9
reference signatures generated by us on all 76576
selected samples resulting in a list of 9878304
(sample, signature, pvalue) pairs.</p>
<p>Our intention is to identify samples that show <em>tissue heterogeneity</em>,
<em>i.e.</em> unintentional profiling of cells of other origin than the target tissue
of profiling. We classify samples into <em>heterogeneous</em> and <em>not heterogeneous</em>.
We call a classification <em>true-positive</em> if the given sample is classified
as <em>heterogeneous</em> and the sample indeed contains cells different from the
annotated tissues. Analogous, we call a classification <em>false-positive</em>
if the given sample is classified as <em>heterogeneous</em> but in reality only contains cells from the annotated tissue.</p>
<p>Naively, we could label a sample as heterogeneous, if a signature unrelated
to the annotated tissue exceeds a certain score. The problem with this
approach is, that some signatures overlap; the resulting scores are therefore
correlated and will lead to false-positives. One cannot simply solve this
problem by excluding genes that are members of multiple signatures, as it is
easily possible to build two (in fact many) distinct, non-overlapping
signatures matching the same tissue, due to gene-gene correlation.</p>
<p>In section <a href="validating-signatures.html#validating-signatures">2</a> we have created and validated
<em>reference signatures</em> for 9 tissues. Even though we have demonstrated that
each signature unambiguously identifies its corresponding tissue (<em>i.e.</em> scores
highest), the signatures could still be correlated. Some of them in fact are,
e.g. cardiac muscle and skeletal muscle (see figure
<a href="testing-for-tissue-heterogeneity.html#fig:correlationexample">4.1</a>). Moreover, we lack sufficient data to perform an
independent-sample validation on the signatures provided by BioQC.<br />
Therefore, to avoid false-positives, for each tissue, we exclude all signature
that are positively correlated with the reference signature. This approach is
more formally described in the following:</p>
<p>A given sample <span class="math inline">\(s\)</span> annotated as tissue <span class="math inline">\(t\)</span> is tested for enrichment with signature <span class="math inline">\(k_{\text{query}}\)</span> resulting in a p-value <span class="math inline">\(p_{\text{query}}\)</span>. Let <span class="math inline">\(k_{\text{ref}}\)</span> be the reference signature associated with tissue <span class="math inline">\(t\)</span> and <span class="math inline">\(p_{\text{ref}}\)</span> the p-value of testing <span class="math inline">\(s\)</span> for enrichment of <span class="math inline">\(k_{\text{ref}}\)</span>. Let <span class="math inline">\(\tau\)</span> be a certain false discovery rate (FDR)-threshold (0.01 in this study).</p>
<ol style="list-style-type: decimal">
<li>If the Benjamini-Hochberg (BH)-adjusted <span class="math inline">\(p_{\text{query}} \ge \tau\)</span>, we
assume that <span class="math inline">\(s\)</span> is not heterogeneous; else continue.</li>
<li>We fit a robust linear model using <code>rlm</code> from the <code>R</code> <code>MASS</code> package of
<span class="math inline">\(|log10(p_{\text{query}})|\)</span> against <span class="math inline">\(|log10(p_{\text{ref}})|\)</span> for all samples
annotated as <span class="math inline">\(t\)</span>.</li>
<li>If the slope of the linear model is <span class="math inline">\(\ge 0.01\)</span>, we exclude the pair of
signatures from the results. If the slope is <span class="math inline">\(&lt; 0.01\)</span> and the FDR-adjusted <span class="math inline">\(p_{\text{query}} &lt; \tau\)</span>,
we consider the sample as heterogeneous. Tissue pairs for which signatures are excluded are
marked as such in the results.</li>
<li>We define heterogeneity as <em>severe</em>, if additionally <span class="math inline">\(p_{\text{ref}} \ge\)</span> 0.05.</li>
</ol>
<div class="figure"><span id="fig:correlationexample"></span>
<img src="95_figures_files/figure-html/correlationexample-1.png" alt="Examples of signature correlation. Panels A-B: scatterplot of the signature scores (y-axis) against the scores of a reference signature (x-axis). The black line indicates the model fitted to the data. Points are colored according to the called heterogeneity status. (A) Skeletal muscle scores of kidney samples against scores of the kidney signature. The samples are not correlated, however some outliers are detected which are samples likely containing muscle cells. (B) Skeletal muscle scores of cardiac muscle samples against skeletal muscle scores. The scores are highly correlated. While most of the points exceed the FDR threshold, they will not be classified as heterogeneous since the signatures are correlated. Panels C and D show the boxplots of the scores of various signatures on kidney and heart samples, respectively. " width="100%" />
<p class="caption">
Figure 4.1: Examples of signature correlation. Panels A-B: scatterplot of the signature scores (y-axis) against the scores of a reference signature (x-axis). The black line indicates the model fitted to the data. Points are colored according to the called heterogeneity status. (A) Skeletal muscle scores of kidney samples against scores of the kidney signature. The samples are not correlated, however some outliers are detected which are samples likely containing muscle cells. (B) Skeletal muscle scores of cardiac muscle samples against skeletal muscle scores. The scores are highly correlated. While most of the points exceed the FDR threshold, they will not be classified as heterogeneous since the signatures are correlated. Panels C and D show the boxplots of the scores of various signatures on kidney and heart samples, respectively.
</p>
</div>
<!-- Boxplots and scatterplots of all combinations for manual inspection -->
<!-- Make main figure -->
<!-- Export heterogeneity statistics to TSV files -->
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="curating-data.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="additional-results.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
