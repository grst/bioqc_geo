<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4 Testing for tissue heterogeneity | Tissue heterogeneity is prevalent in gene expression studies (Supplementary Information)</title>
  <meta name="description" content="In this study, we systematically search GEO and ARCHS4 for cases of “tissue heterogeneity”." />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="4 Testing for tissue heterogeneity | Tissue heterogeneity is prevalent in gene expression studies (Supplementary Information)" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="In this study, we systematically search GEO and ARCHS4 for cases of “tissue heterogeneity”." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4 Testing for tissue heterogeneity | Tissue heterogeneity is prevalent in gene expression studies (Supplementary Information)" />
  
  <meta name="twitter:description" content="In this study, we systematically search GEO and ARCHS4 for cases of “tissue heterogeneity”." />
  

<meta name="author" content="Gregor Sturm, Markus List, Jitao David Zhang" />


<meta name="date" content="2020-11-27" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="curating-data.html"/>
<link rel="next" href="references.html"/>
<script src="libs/header-attrs-2.4/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> About this document</a></li>
<li class="chapter" data-level="2" data-path="validating-signatures.html"><a href="validating-signatures.html"><i class="fa fa-check"></i><b>2</b> Validating Tissue Signatures</a>
<ul>
<li class="chapter" data-level="2.1" data-path="validating-signatures.html"><a href="validating-signatures.html#data"><i class="fa fa-check"></i><b>2.1</b> Data</a></li>
<li class="chapter" data-level="2.2" data-path="validating-signatures.html"><a href="validating-signatures.html#cross-validation-of-signatures-on-the-gtex-dataset"><i class="fa fa-check"></i><b>2.2</b> Cross-Validation of signatures on the GTEx dataset</a></li>
<li class="chapter" data-level="2.3" data-path="validating-signatures.html"><a href="validating-signatures.html#reference-signatures"><i class="fa fa-check"></i><b>2.3</b> Reference Signatures</a></li>
<li class="chapter" data-level="2.4" data-path="validating-signatures.html"><a href="validating-signatures.html#cross-platform-cross-species-validation"><i class="fa fa-check"></i><b>2.4</b> Cross-Platform Cross-Species Validation</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="curating-data.html"><a href="curating-data.html"><i class="fa fa-check"></i><b>3</b> Sample data and metadata</a>
<ul>
<li class="chapter" data-level="3.1" data-path="curating-data.html"><a href="curating-data.html#normalize-tissues"><i class="fa fa-check"></i><b>3.1</b> Standardize Tissue Names</a></li>
<li class="chapter" data-level="3.2" data-path="curating-data.html"><a href="curating-data.html#geo"><i class="fa fa-check"></i><b>3.2</b> GEO</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="curating-data.html"><a href="curating-data.html#downloading-geo-data"><i class="fa fa-check"></i><b>3.2.1</b> Downloading GEO data</a></li>
<li class="chapter" data-level="3.2.2" data-path="curating-data.html"><a href="curating-data.html#filtering-geo-data"><i class="fa fa-check"></i><b>3.2.2</b> Filtering GEO data</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="curating-data.html"><a href="curating-data.html#archs4"><i class="fa fa-check"></i><b>3.3</b> ARCHS4</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="testing-for-tissue-heterogeneity.html"><a href="testing-for-tissue-heterogeneity.html"><i class="fa fa-check"></i><b>4</b> Testing for tissue heterogeneity</a>
<ul>
<li class="chapter" data-level="4.1" data-path="testing-for-tissue-heterogeneity.html"><a href="testing-for-tissue-heterogeneity.html#sec:signatures"><i class="fa fa-check"></i><b>4.1</b> Tissue signatures</a></li>
<li class="chapter" data-level="4.2" data-path="testing-for-tissue-heterogeneity.html"><a href="testing-for-tissue-heterogeneity.html#testing-samples-for-heterogeneity"><i class="fa fa-check"></i><b>4.2</b> Testing samples for heterogeneity</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="testing-for-tissue-heterogeneity.html"><a href="testing-for-tissue-heterogeneity.html#determining-tau."><i class="fa fa-check"></i><b>4.2.1</b> Determining <span class="math inline">\(\tau\)</span>.</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>5</b> References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Tissue heterogeneity is prevalent in gene expression studies (Supplementary Information)</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="testing-for-tissue-heterogeneity" class="section level1" number="4">
<h1><span class="header-section-number">4</span> Testing for tissue heterogeneity</h1>
<div id="sec:signatures" class="section level2" number="4.1">
<h2><span class="header-section-number">4.1</span> Tissue signatures</h2>
<p>In section <a href="validating-signatures.html#validating-signatures">2</a>, we identified a set of
9 <em>reference signatures</em> (table <a href="testing-for-tissue-heterogeneity.html#tab:refsig">4.1</a>) which unambiguously
identify their corresponding tissue across platforms and species. In addition to that,
we use 120 tissue signatures from the BioQC publication, which we refer to as <em>query signatures</em>.</p>
<table>
<caption><span id="tab:refsig">Table 4.1: </span>reference signatures</caption>
<thead>
<tr class="header">
<th align="left">Reference Signature</th>
<th align="left">Tissue</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">GTEX_Blood</td>
<td align="left">blood</td>
</tr>
<tr class="even">
<td align="left">GTEX_Brain</td>
<td align="left">brain</td>
</tr>
<tr class="odd">
<td align="left">GTEX_Heart</td>
<td align="left">heart</td>
</tr>
<tr class="even">
<td align="left">GTEX_Kidney</td>
<td align="left">kidney</td>
</tr>
<tr class="odd">
<td align="left">GTEX_Liver</td>
<td align="left">liver</td>
</tr>
<tr class="even">
<td align="left">GTEX_Muscle_Skeletal</td>
<td align="left">skeletal muscle</td>
</tr>
<tr class="odd">
<td align="left">GTEX_Pancreas</td>
<td align="left">pancreas</td>
</tr>
<tr class="even">
<td align="left">GTEX_Skin</td>
<td align="left">skin</td>
</tr>
<tr class="odd">
<td align="left">GTEX_Testis</td>
<td align="left">testis</td>
</tr>
</tbody>
</table>
</div>
<div id="testing-samples-for-heterogeneity" class="section level2" number="4.2">
<h2><span class="header-section-number">4.2</span> Testing samples for heterogeneity</h2>
<p>We tested for enrichment of
120
selected signatures provided by BioQC, the
9
reference signatures generated by us, and one random control signature of
100 randomly drawn genes on all 76576 selected samples
resulting in a list of 10031456 (sample, signature, pvalue) pairs.</p>
<p>Our intention is to identify samples that show <em>tissue heterogeneity</em>,
<em>i.e.</em> unintentional profiling of cells of other origin than the target tissue
of profiling. We classify samples into <em>heterogeneous</em> and <em>not heterogeneous</em>.
We call a classification <em>true-positive</em> if the given sample is classified
as <em>heterogeneous</em> and the sample indeed contains cells different from the
annotated tissues. Analogous, we call a classification <em>false-positive</em>
if the given sample is classified as <em>heterogeneous</em> but in reality only contains cells from the annotated tissue.</p>
<p>Naively, we would label a sample as heterogeneous, if a signature unrelated
to the annotated tissue exceeds a certain score. The problem with this
approach is, that some signatures overlap; the resulting scores are therefore
correlated and will lead to false-positives. One cannot simply solve this
problem by excuding genes that are members of multiple signatures, as it is
easily possible to build two (in fact many) distinct, non-overlapping
signatures matching the same tissue.</p>
<p>In section <a href="validating-signatures.html#validating-signatures">2</a> we have created toroughly validated
<em>reference signatures</em> for 9 tissues. Even though we have demonstrated that
each signature unambigously identifies its corresponding tissue (<em>i.e.</em> scores
highest), the signatures could still be correlated. Some of them in fact are,
e.g. cardiac muscle and skeletal muscle (see figure
<a href="testing-for-tissue-heterogeneity.html#fig:correlationexample">4.1</a>). Moreover, we lack sufficient data to perform an
independent-sample validation on the signatures provided by BioQC. Accounting
for correlation with the reference signatures, we can still avoid
false-positives, even if a signature is characteristic for a tissue
histologically close to the annotated tissue.</p>
<p>We, therefore, take the following approach to account for the correlation of signatures:
A given sample <span class="math inline">\(s\)</span> annotated as tissue <span class="math inline">\(t\)</span> is tested for enrichment with signature <span class="math inline">\(k_{\text{test}}\)</span> resulting in a p-value <span class="math inline">\(p_{\text{test}}\)</span>. Let <span class="math inline">\(k_{\text{ref}}\)</span> be the reference signature associated with tissue <span class="math inline">\(t\)</span> and <span class="math inline">\(p_{\text{ref}}\)</span> the p-value of testing <span class="math inline">\(s\)</span> for enrichment of <span class="math inline">\(k_{\text{ref}}\)</span>. Let <span class="math inline">\(\tau\)</span> be a certain false discovery rate (FDR)-threshold.</p>
<ol style="list-style-type: decimal">
<li>If the Benjamini-Hochberg (BH)-adjusted <span class="math inline">\(p_{\text{test}} \ge \tau\)</span>, we
assume that <span class="math inline">\(s\)</span> is not heterogeneous; else continue.</li>
<li>We fit a linear model using <code>rlm</code> from the <code>R</code> <code>MASS</code> package of
<span class="math inline">\(|log10(p_{\text{test}})|\)</span> against <span class="math inline">\(|log10(p_{\text{ref}})|\)</span> for all samples
annotated as <span class="math inline">\(t\)</span>. We assume that the residuals <span class="math inline">\(R\)</span> of the linear model follow
a normal distribution <span class="math inline">\(R \sim \mathcal{N}(0, \sigma^2)\)</span>, where <span class="math inline">\(\sigma\)</span> is the
standard deviation of the residuals.</li>
<li>We extract the residual <span class="math inline">\(r\)</span> corresponding to sample <span class="math inline">\(s\)</span>. We calculate the
p-value <span class="math inline">\(p_{\text{corr}} = 1 - \text{CDF}_R(r)\)</span> where <span class="math inline">\(\text{CDF}_R\)</span> is the
cumulative density function of <span class="math inline">\(\mathcal{N}(0, \sigma^2)\)</span>.</li>
<li>If the BH-adjusted <span class="math inline">\(p_{\text{corr}} &lt; \tau\)</span>, we reject the
hypothesis that <span class="math inline">\(k_{\text{test}}\)</span> is enriched only due to correlation and label
the sample as heterogeneous.</li>
</ol>
<div id="determining-tau." class="section level3" number="4.2.1">
<h3><span class="header-section-number">4.2.1</span> Determining <span class="math inline">\(\tau\)</span>.</h3>
<p>We desire an overall FDR of 0.01. Since we test in a two-step procedure, we choose a threshold <span class="math inline">\(\tau\)</span>, such that the
overall FDR equals 0.01.</p>
<p><span class="math display">\[
\text{FDR} = \tau + (1-\tau) \tau
\]</span>
Explanation:
Of all positives in step 1, there are, per definition, a fraction of <span class="math inline">\(\tau\)</span> false-positives and <span class="math inline">\(1-\tau\)</span> true-positives.
To all positives, the step 2 test is applied. In addition to the false-positives from step 1, there is a fraction of <span class="math inline">\(\tau(1-\tau)\)</span> false-positives among the true-positives from step 1.</p>
<p>Solving the equation yields:
<span class="math display">\[
0.01 = \tau + (1-\tau)\tau \Leftrightarrow 0 = \tau^2 - 2\tau + 0.01
\]</span></p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="testing-for-tissue-heterogeneity.html#cb1-1" aria-hidden="true"></a>tau =<span class="st"> </span><span class="kw">polyroot</span>(<span class="kw">c</span>(FDR_THRES, <span class="dv">-2</span>, <span class="dv">1</span>))[<span class="dv">1</span>]</span>
<span id="cb1-2"><a href="testing-for-tissue-heterogeneity.html#cb1-2" aria-hidden="true"></a>tau</span></code></pre></div>
<pre><code>## [1] 0.005012563-0i</code></pre>
<div class="figure"><span id="fig:correlationexample"></span>
<img src="40_heterogeneity_test_files/figure-html/correlationexample-1.png" alt="Examples of signature correlation. Panels A-C: correlation of the signature scores (y-axis) against the scores of a reference signature (x-axis). The purple line indicates the model fitted to the data. Points falling into the shaded area can be explained by the linear model. Points are colored according to whether they would be discarded already in the FDR-filtering step. (A) Brain scores of kidney samples against the scores of the kidney signature. There is virtually no correlation, nor are there outliers. Apparently, no kidney samples are contaminated with neuronal cells. (B) Liver scores of kidney samples against scores of the kidney signature. The samples are not correlated, however some outliers are detected which are samples potentially containing liver cells. (C) Cardiac muscle scores of skeletal muscle samples against skeletal muscle scores. The scores are highly correlated. While most of the points exceed the FDR threshold, they will not be classified as outliers because the elevated score can be explained by the correlation. Panels D and E show the boxplots of the scores of various signatures on kidney and heart samples, respectively. " width="100%" />
<p class="caption">
Figure 4.1: Examples of signature correlation. Panels A-C: correlation of the signature scores (y-axis) against the scores of a reference signature (x-axis). The purple line indicates the model fitted to the data. Points falling into the shaded area can be explained by the linear model. Points are colored according to whether they would be discarded already in the FDR-filtering step. (A) Brain scores of kidney samples against the scores of the kidney signature. There is virtually no correlation, nor are there outliers. Apparently, no kidney samples are contaminated with neuronal cells. (B) Liver scores of kidney samples against scores of the kidney signature. The samples are not correlated, however some outliers are detected which are samples potentially containing liver cells. (C) Cardiac muscle scores of skeletal muscle samples against skeletal muscle scores. The scores are highly correlated. While most of the points exceed the FDR threshold, they will not be classified as outliers because the elevated score can be explained by the correlation. Panels D and E show the boxplots of the scores of various signatures on kidney and heart samples, respectively.
</p>
</div>
<div style="page-break-after: always;"></div>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="curating-data.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="references.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
